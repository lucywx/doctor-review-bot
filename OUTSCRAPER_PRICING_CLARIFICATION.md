# Outscraper 定价详解

## 关键问题："75条评价" 是什么意思？

### 答案：**实际抓取并返回的评价数量**（不是搜索范围）

---

## Outscraper 工作原理

### 场景示例：搜索 Dr. Nicholas Lim

```
步骤 1：在 Google Maps 搜索
→ 找到 "Columbia Asia Hospital - Petaling Jaya"
→ 这个医院有 5,558 条评价（总量）

步骤 2：你设置参数
reviews_per_business = 50  ← 指定抓取 50 条

步骤 3：Outscraper 抓取
→ 从 5,558 条中抓取 50 条
→ 返回 50 条完整评价内容（文本、评分、日期、作者等）

步骤 4：计费
50 条 × $0.012 = $0.60
```

**关键点**：
- **搜索范围**：5,558 条（医院所有评价）
- **实际抓取**：50 条（你获得的评价数）
- **计费依据**：50 条（你实际获得的数量）

---

## 与 Google Places API 对比

### Google Places API（当前使用）

```
医院总评价数：5,558 条

API 返回：5 条（硬性限制，无法改变）
计费：免费（有 $200/月额度）

问题：
- 只能获取最新 5 条
- 这 5 条可能都不是关于 Dr. Nicholas Lim 的
- 无法翻页获取更多
```

### Outscraper API

```
医院总评价数：5,558 条

API 返回：你指定的数量（例如 50 条、100 条）
计费：$0.012 每条评价

优势：
- ✅ 可以获取 50+ 条评价
- ✅ 从更大样本中找到相关评价
- ✅ 可以按时间排序或随机采样
- ✅ 支持批量抓取

例如：
- 设置 reviews_per_business = 50 → 获得 50 条 → $0.60
- 设置 reviews_per_business = 100 → 获得 100 条 → $1.20
```

---

## 为什么需要抓取 50+ 条评价？

### 概率分析

**场景**：Columbia Asia Hospital 有 10 个医生，5,558 条评价

假设评价均匀分布：
- 每个医生约有 555 条评价
- 每条评价提到特定医生的概率：1/10 = 10%

**Google Places API（5条）**：
```
5 条评价中找到 Dr. Nicholas Lim 的概率：
- 至少 1 条相关：1 - (0.9)^5 = 41%
- 预期相关评价数：5 × 0.1 = 0.5 条

实际结果：0-1 条相关评价（很可能是 0）
```

**Outscraper（50条）**：
```
50 条评价中找到 Dr. Nicholas Lim 的概率：
- 至少 1 条相关：1 - (0.9)^50 ≈ 99.5%
- 预期相关评价数：50 × 0.1 = 5 条

实际结果：3-7 条相关评价
```

**Outscraper（100条）**：
```
100 条评价中找到的概率：
- 至少 1 条相关：≈ 99.99%
- 预期相关评价数：100 × 0.1 = 10 条

实际结果：8-12 条相关评价
```

**结论**：抓取更多评价 = 更高概率找到相关评价

---

## 实际使用配置建议

### 配置 1：保守配置（推荐）⭐

```python
result = outscraper_client.search_with_reviews(
    query="Dr. Nicholas Lim Lye Tak Malaysia",
    location="Malaysia",
    business_limit=1,           # 只搜索最相关的 1 个商家
    reviews_per_business=50     # 每个商家抓 50 条
)

每次搜索：
- 抓取 1 个商家 × 50 条 = 50 条评价
- 成本：50 × $0.012 = $0.60/次
- 预期找到：3-7 条相关评价
```

### 配置 2：标准配置

```python
result = outscraper_client.search_with_reviews(
    query="Dr. Nicholas Lim Lye Tak Malaysia",
    location="Malaysia",
    business_limit=2,           # 搜索 2 个可能的商家
    reviews_per_business=50     # 每个商家抓 50 条
)

每次搜索：
- 抓取 2 个商家 × 50 条 = 100 条评价
- 成本：100 × $0.012 = $1.20/次
- 预期找到：6-14 条相关评价（覆盖医生的多个诊所）
```

### 配置 3：高覆盖配置

```python
result = outscraper_client.search_with_reviews(
    query="Dr. Nicholas Lim Lye Tak Malaysia",
    location="Malaysia",
    business_limit=2,
    reviews_per_business=100    # 每个商家抓 100 条
)

每次搜索：
- 抓取 2 个商家 × 100 条 = 200 条评价
- 成本：200 × $0.012 = $2.40/次
- 预期找到：16-24 条相关评价
```

---

## 月度成本计算（30用户，50次/月）

**总搜索次数**：30 × 50 = 1,500 次/月

### 保守配置（50条/次）⭐ 推荐

```
月度使用：
- 每次抓取：50 条
- 总评价数：1,500 × 50 = 75,000 条

成本：
- 免费额度：500 条
- 需付费：75,000 - 500 = 74,500 条
- 成本：74,500 × $0.012 = $894/月

每用户成本：$894 / 30 = $29.80/月
每次搜索成本：$894 / 1,500 = $0.60/次
```

### 标准配置（100条/次）

```
月度使用：
- 每次抓取：100 条（2个商家 × 50条）
- 总评价数：1,500 × 100 = 150,000 条

成本：
- 免费额度：500 条
- 需付费：150,000 - 500 = 149,500 条
- 成本：149,500 × $0.012 = $1,794/月

每用户成本：$1,794 / 30 = $59.80/月
每次搜索成本：$1,794 / 1,500 = $1.20/次
```

### 高覆盖配置（200条/次）

```
月度使用：
- 每次抓取：200 条（2个商家 × 100条）
- 总评价数：1,500 × 200 = 300,000 条

成本：
- 免费额度：500 条
- 需付费：300,000 - 500 = 299,500 条
- 成本：299,500 × $0.012 = $3,594/月

每用户成本：$3,594 / 30 = $119.80/月
每次搜索成本：$3,594 / 1,500 = $2.40/次
```

---

## 修正后的总成本（ChatGPT + Outscraper）

### 方案 A：保守配置 ⭐ 推荐

| 成本项 | 月成本 |
|--------|--------|
| Outscraper（50条/次） | $894 |
| ChatGPT API (GPT-4o-mini) | $5.19 |
| Railway 服务器 | $10 |
| **总计（无缓存）** | **$909** |
| **总计（40%缓存）** | **$545** |

**每用户成本**：$545 / 30 = $18.17/月
**每次搜索成本**：$545 / 1,500 = $0.36/次

### 方案 B：标准配置

| 成本项 | 月成本 |
|--------|--------|
| Outscraper（100条/次） | $1,794 |
| ChatGPT API (GPT-4o-mini) | $5.19 |
| Railway 服务器 | $10 |
| **总计（无缓存）** | **$1,809** |
| **总计（40%缓存）** | **$1,085** |

**每用户成本**：$1,085 / 30 = $36.17/月
**每次搜索成本**：$1,085 / 1,500 = $0.72/次

---

## 进一步优化建议

### 优化 1：动态调整抓取数量

```python
async def smart_search(doctor_name):
    # 第一次：先抓 30 条（成本 $0.36）
    result = await outscraper.search_with_reviews(
        query=doctor_name,
        reviews_per_business=30
    )

    # 用 GPT-4 快速过滤
    relevant = filter_reviews(result, doctor_name)

    # 如果找到 5+ 条相关评价 → 停止
    if len(relevant) >= 5:
        return relevant

    # 如果不够 → 再抓 20 条（总计 50 条）
    result2 = await outscraper.search_with_reviews(
        query=doctor_name,
        reviews_per_business=50,
        skip=30  # 跳过前 30 条
    )

    return filter_reviews(result + result2, doctor_name)
```

**预期效果**：
- 60% 的搜索只需要 30 条（$0.36）
- 40% 的搜索需要 50 条（$0.60）
- 平均成本：0.6 × $0.36 + 0.4 × $0.60 = $0.456/次
- 月度成本：1,500 × $0.456 = $684

**节省**：$894 - $684 = $210/月（-24%）

### 优化 2：智能缓存热门医生

```
策略：
- 识别热门医生（被搜索 5+ 次）
- 缓存这些医生的评价（7天）
- 缓存命中率：40-50%

效果：
- 原成本：$894/月
- 缓存后：$894 × 0.6 = $536/月
- 节省：$358/月（-40%）
```

---

## 最终建议

### 推荐配置：保守配置 + 缓存

```
Outscraper：
- business_limit: 1
- reviews_per_business: 50
- 缓存命中率：40%

月度成本：
- Outscraper: $894 × 0.6 = $536
- ChatGPT: $5.19 × 0.6 = $3.11
- Railway: $10
- 总计: $549/月

每用户：$549 / 30 = $18.30/月
每次搜索：$549 / 1,500 = $0.37/次
```

### 定价建议

如果要收费：
- 订阅制：$25-30/月/用户（37-64% 利润率）
- 按次收费：$0.75-1.00/次（100-170% 利润率）

**盈亏平衡点**：
- 订阅制（$25/月）：需要 22 用户
- 按次收费（$0.75/次）：需要 732 次/月

---

## 总结

### 关键澄清

**"75条评价"** = Outscraper 实际抓取并返回给你的评价数量

- 不是搜索范围
- 是你获得的具体评价内容
- 计费基于这个数量（$0.012/条）

### 成本答案（修正版）

**30用户，50次/月，1,500次总计**：

| 配置 | Outscraper月成本 | 总成本（含ChatGPT+服务器+缓存） | 每用户/月 |
|------|----------------|---------------------------|----------|
| 保守（50条/次）⭐ | $894 | **$549** | **$18.30** |
| 标准（100条/次） | $1,794 | $1,085 | $36.17 |
| 高覆盖（200条/次） | $3,594 | $2,156 | $71.87 |

**推荐**：保守配置 + 40%缓存 = **$549/月**

---

**文档创建时间**：2025-10-30
**关键发现**：Outscraper 是按实际返回的评价数量计费，不是搜索范围
